<app-page-header
  title="Gesti贸n de IPRESS"
  subtitle="Administra las instituciones prestadoras de servicios de salud"
  icon="bi bi-building"
  actionType="button"
  actionText="Nueva IPRESS"
  actionRoute="/admin/ipress/create"
  actionIcon="bi bi-plus-circle"
  primaryColor="#28a745"
  secondaryColor="#20c997"
  [showAction]="true">
</app-page-header>

<div class="ipress-container">
  <!-- Page Header -->


  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-card">
      <div class="row align-items-end">
        <div class="col-md-6">
          <div class="search-input-group">
            <i class="bi bi-search search-icon"></i>
            <input 
              type="text" 
              class="form-control search-input" 
              placeholder="Buscar por nombre, RUC o email..." 
              [(ngModel)]="searchTerm"
              (input)="filterIpress()"
            >
            <button 
              *ngIf="searchTerm" 
              class="search-clear" 
              (click)="clearSearch()"
              type="button"
            >
              <i class="bi bi-x"></i>
            </button>
          </div>
        </div>
        <div class="col-md-6">
          <div class="results-info">
            <span class="results-count">{{ filteredIpress.length }}</span>
            <span class="results-label">IPRESS encontradas</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Section -->
  <div class="content-section">
    
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="loading-content">
        <div class="spinner-border text-info" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <h5 class="mt-3">Cargando IPRESS</h5>
        <p class="text-muted">Obteniendo informaci贸n de las instituciones...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error-state">
      <div class="error-content">
        <i class="bi bi-exclamation-triangle text-danger"></i>
        <h5 class="mt-3">Error al cargar</h5>
        <p class="text-muted mb-3">{{ error }}</p>
        <button class="btn btn-outline-danger" (click)="loadIpress()">
          <i class="bi bi-arrow-clockwise me-2"></i>Reintentar
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && filteredIpress.length === 0" class="empty-state">
      <div class="empty-content">
        <i class="bi bi-building text-muted"></i>
        <h5 class="mt-3">No hay IPRESS registradas</h5>
        <p class="text-muted mb-3">Comienza registrando la primera instituci贸n de salud</p>
        <button class="btn btn-primary" [routerLink]="['/admin/ipress/create']">
          <i class="bi bi-plus-circle me-2"></i>Registrar Primera IPRESS
        </button>
      </div>
    </div>

    <!-- IPRESS Table -->
    <div *ngIf="!loading && !error && filteredIpress.length > 0" class="ipress-table-container">
      <div class="table-card">
        <div class="table-responsive">
          <table class="table table-modern">
            <thead>
              <tr>
                <th class="th-ipress">IPRESS</th>
                <th class="th-ruc">RUC</th>
                <th class="th-contact">Contacto</th>
                <th class="th-location">Ubicaci贸n</th>
                <th class="th-status">Estado</th>
                <th class="th-actions">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of filteredIpress" class="ipress-row">
                <td>
                  <div class="ipress-info">
                    <div class="ipress-avatar">
                      {{ getInitials(item.nombre) }}
                    </div>
                    <div class="ipress-details">
                      <div class="ipress-name">{{ item.nombre }}</div>
                      <div class="ipress-id">ID: {{ item.id }}</div>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="ruc-info">
                    <div class="ruc-number">{{ item.ruc || 'No registrado' }}</div>
                  </div>
                </td>
                <td>
                  <div class="contact-info">
                    <div class="contact-phone" *ngIf="item.telefono">
                      <i class="bi bi-telephone me-1"></i>{{ item.telefono }}
                    </div>
                    <div class="contact-email" *ngIf="item.email">
                      <i class="bi bi-envelope me-1"></i>{{ item.email }}
                    </div>
                    <div *ngIf="!item.telefono && !item.email" class="text-muted">
                      Sin contacto
                    </div>
                  </div>
                </td>
                <td>
                  <div class="location-info">
                    <div class="location-address">{{ item.direccion || 'No registrada' }}</div>
                  </div>
                </td>
                <td>
                  <span class="status-badge" [ngClass]="getEstadoBadgeClass(item.estado_id)">
                    <i class="bi" [ngClass]="{
                      'bi-check-circle': item.estado_id === 1,
                      'bi-x-circle': item.estado_id === 2,
                      'bi-question-circle': !item.estado_id
                    }"></i>
                    {{ item.estado_id === 1 ? 'Activo' : item.estado_id === 2 ? 'Inactivo' : 'Sin estado' }}
                  </span>
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-action btn-view" [routerLink]="['/admin/ipress/detail', item.id]" title="Ver detalles">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn-action btn-edit" [routerLink]="['/admin/ipress/edit', item.id]" title="Editar">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn-action btn-delete" (click)="deleteIpress(item.id!)" title="Eliminar">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>