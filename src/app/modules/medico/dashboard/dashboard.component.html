<div class="dashboard-container">
  <!-- Welcome Header -->
  <div class="welcome-header mb-4">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="dashboard-title mb-2">
          <i class="bi bi-heart-pulse-fill me-3"></i>
          Panel Médico - Dr. {{ medicoNombre }}
        </h1>
        <p class="dashboard-subtitle mb-0">Gestiona tu práctica médica de manera eficiente</p>
      </div>
      <div class="col-md-4 text-end">
        <div class="dashboard-date">
          <i class="bi bi-calendar3 me-2"></i>
          {{ currentDate | date:'fullDate':'es-ES' }}
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-card">
      <div class="spinner-border text-primary mb-3" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <h5>Cargando datos del dashboard...</h5>
      <p class="text-muted">Por favor espera mientras obtenemos la información más reciente</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="alert alert-danger alert-modern">
    <div class="d-flex align-items-center">
      <i class="bi bi-exclamation-triangle-fill me-3 fs-4"></i>
      <div class="flex-grow-1">
        <h6 class="mb-1">Error al cargar los datos</h6>
        <p class="mb-0">{{ error }}</p>
      </div>
      <button class="btn btn-outline-danger" (click)="loadDashboardData()">
        <i class="bi bi-arrow-clockwise me-2"></i>Reintentar
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="row stats-row" *ngIf="!loading && !error">
    <div class="col-xl-3 col-md-6 mb-4">
      <div class="stats-card stats-card-primary">
        <div class="stats-card-body">
          <div class="stats-icon">
            <i class="bi bi-people-fill"></i>
          </div>
          <div class="stats-content">
            <div class="stats-number">{{ pacientesAtendidosHoy }}</div>
            <div class="stats-label">Pacientes Atendidos Hoy</div>
            <div class="stats-trend">
              <i class="bi bi-arrow-up"></i>
              <span>+{{ tendenciaPacientes }}% vs ayer</span>
            </div>
          </div>
        </div>
        <div class="stats-footer">
          <a routerLink="/medico/pacientes" class="stats-link">
            Ver pacientes <i class="bi bi-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="stats-card stats-card-success">
        <div class="stats-card-body">
          <div class="stats-icon">
            <i class="bi bi-calendar-check-fill"></i>
          </div>
          <div class="stats-content">
            <div class="stats-number">{{ citasPendientes }}</div>
            <div class="stats-label">Citas Pendientes</div>
            <div class="stats-trend">
              <i class="bi bi-clock"></i>
              <span>Próxima en {{ proximaCita }} min</span>
            </div>
          </div>
        </div>
        <div class="stats-footer">
          <a routerLink="/medico/agenda" class="stats-link">
            Ver agenda <i class="bi bi-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="stats-card stats-card-info">
        <div class="stats-card-body">
          <div class="stats-icon">
            <i class="bi bi-clock-fill"></i>
          </div>
          <div class="stats-content">
            <div class="stats-number">{{ horasTrabajadasSemana }}</div>
            <div class="stats-label">Horas Trabajadas (Semana)</div>
            <div class="stats-trend">
              <i class="bi bi-graph-up"></i>
              <span>{{ eficienciaSemana }}% eficiencia</span>
            </div>
          </div>
        </div>
        <div class="stats-footer">
          <a routerLink="/medico/horarios" class="stats-link">
            Ver horarios <i class="bi bi-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="stats-card stats-card-warning">
        <div class="stats-card-body">
          <div class="stats-icon">
            <i class="bi bi-prescription2"></i>
          </div>
          <div class="stats-content">
            <div class="stats-number">{{ recetasEmitidas }}</div>
            <div class="stats-label">Recetas Emitidas (Mes)</div>
            <div class="stats-trend">
              <i class="bi bi-arrow-up"></i>
              <span>+{{ tendenciaRecetas }}% vs mes anterior</span>
            </div>
          </div>
        </div>
        <div class="stats-footer">
          <a routerLink="/medico/recetas" class="stats-link">
            Ver recetas <i class="bi bi-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts and Tables Section -->
  <div class="row" *ngIf="!loading && !error">
    <!-- Consultas Chart -->
    <div class="col-xl-8 col-lg-7 mb-4">
      <div class="chart-card">
        <div class="chart-header">
          <h5 class="chart-title">
            <i class="bi bi-graph-up me-2"></i>
            Consultas por Mes
          </h5>
          <div class="chart-actions">
            <button class="btn btn-outline-primary btn-sm me-2">
              <i class="bi bi-download"></i> Exportar
            </button>
            <div class="dropdown">
              <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <i class="bi bi-three-dots"></i>
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Ver detalles</a></li>
                <li><a class="dropdown-item" href="#">Configurar</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="chart-body">
          <canvas id="consultasChart" height="100"></canvas>
        </div>
      </div>
    </div>

    <!-- Especialidades Chart -->
    <div class="col-xl-4 col-lg-5 mb-4">
      <div class="chart-card">
        <div class="chart-header">
          <h5 class="chart-title">
            <i class="bi bi-pie-chart me-2"></i>
            Consultas por Especialidad
          </h5>
        </div>
        <div class="chart-body">
          <canvas id="especialidadesChart" height="150"></canvas>
          <div class="chart-legend mt-3">
            <div class="legend-item" *ngFor="let item of especialidadesData">
              <span class="legend-color" [style.background-color]="item.color"></span>
              <span class="legend-label">{{ item.label }}</span>
              <span class="legend-value">{{ item.value }}%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Appointments Table -->
  <div class="row" *ngIf="!loading && !error">
    <div class="col-12">
      <div class="table-card">
        <div class="table-header">
          <h5 class="table-title">
            <i class="bi bi-calendar-event me-2"></i>
            Próximas Citas
          </h5>
          <div class="table-actions">
            <button class="btn btn-primary btn-sm" routerLink="/medico/agenda">
              <i class="bi bi-plus-lg me-2"></i>Nueva Cita
            </button>
          </div>
        </div>
        <div class="table-body">
          <div class="table-responsive">
            <table class="table table-modern">
              <thead>
                <tr>
                  <th>Paciente</th>
                  <th>Fecha y Hora</th>
                  <th>Especialidad</th>
                  <th>Motivo</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let cita of proximasCitas">
                  <td>
                    <div class="patient-info">
                      <div class="patient-avatar">
                        <i class="bi bi-person-circle"></i>
                      </div>
                      <div class="patient-details">
                        <div class="patient-name">{{ cita.pacienteNombre }}</div>
                        <div class="patient-id">{{ cita.pacienteDocumento }}</div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="appointment-time">
                      <div class="appointment-date">{{ cita.fecha | date:'dd/MM/yyyy' }}</div>
                      <div class="appointment-hour">{{ cita.horaInicio }} - {{ cita.horaFin }}</div>
                    </div>
                  </td>
                  <td>
                    <span class="specialty-badge">{{ cita.especialidad }}</span>
                  </td>
                  <td>
                    <div class="motivo-text">{{ cita.motivo || 'Consulta general' }}</div>
                  </td>
                  <td>
                    <span class="status-badge" [ngClass]="'status-' + cita.estado.toLowerCase()">
                      {{ cita.estado }}
                    </span>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <button class="btn btn-sm btn-outline-primary me-1" 
                              [routerLink]="['/medico/consulta', cita.id]" 
                              title="Iniciar consulta">
                        <i class="bi bi-play-fill"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-secondary me-1" 
                              [routerLink]="['/medico/citas', cita.id]" 
                              title="Ver detalles">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-warning" 
                              (click)="editarCita(cita.id)" 
                              title="Editar cita">
                        <i class="bi bi-pencil"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>